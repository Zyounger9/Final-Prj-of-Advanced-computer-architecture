// This Verilog testbench file will simulate a hardware module using EDAPlayground
// Date: 2025-12-02
// Version 0.1
// Refactored testbench by: Kanhoye, Trevor, Zhang, Yang and Ahishakiye, Thierry

module testbench;

  // --- 1. PARAMETERS ---
  // Define time unit and clock parameters
  localparam CLK_PERIOD = 10;      // 10 time units (e.g., 10ns)
  localparam CLK_HALF_PERIOD = 5;  // 5 time units
  localparam NUM_CYCLES = 50;      // Run for 50 clock cycles (500 time units)

  // --- 2. SIGNALS ---
  reg clk;
  reg rst;

  // --- 3. CLOCKING BLOCK (Optional but Recommended for Clean TBD) ---
  // Defines a sampling point (default is #1 step before the edge)
  clocking cb @(posedge clk);
    // Drive 'rst' at the negative edge (a common practice)
    default input #1step output #0; 
    output rst;
  endclocking

  // --- 4. UNIT UNDER TEST (UUT) ---
  RISC_V_Processor_Pipelined uut (
    .clk(clk),
    .rst(rst)
  );

  // --- 5. CLOCK GENERATION ---
  initial begin
    clk = 0;
    // Clock runs forever, toggling every CLK_HALF_PERIOD
    forever #CLK_HALF_PERIOD clk = ~clk; 
  end

  // --- 6. SIMULATION CONTROL and RESET SEQUENCE ---
  initial begin
    // Setup for waveform tracing - only dump essential UUT signals
    $dumpfile("dump.vcd");
    $dumpvars(0, clk, rst);
    $dumpvars(0, uut.PC_Out_F, uut.Result_W); // Dump key UUT outputs

    // Reset Sequence using clocking block output
    rst = 1'b1; // Assert Reset
    #CLK_PERIOD; // Hold reset for one full clock cycle
    rst = 1'b0; // De-assert Reset

    // Wait for the defined number of cycles + 1 extra cycle for cleanup
    repeat (NUM_CYCLES + 1) @(posedge clk);
    
    $finish; // Terminate simulation
  end

  // --- 7. MONITORING (Using $monitor for concise logging) ---
  initial begin
    // $monitor prints whenever one of its arguments changes.
    // Start monitoring only after reset is de-asserted.
    @(negedge rst); 

    $monitor("Time: %0t | PC: %h | Result(WriteBack): %h", 
             $time, uut.PC_Out_F, uut.Result_W);
  end

endmodule
